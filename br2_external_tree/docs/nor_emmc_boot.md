# Boot the board from NOR + eMMC memory

Applicable platforms: STM32MP257F-EV1.

First, before the Buildroot build you have to update fw_env.config link
to follow the new location of the U-boot environment in the NOR memory.
Without this RAUC will fail at reading the U-boot environment.

```
$ ln -sf fw_env_nor.config buildroot-external-st/board/stmicroelectronics/stm32mp2/overlay-demo/etc/fw_env.config
```

Then flash the board as explained in the [STM32Cube programmer doc](docs/stm32cubeprogrammer.md)
but using the flash_nor_emmc.tsv flash layout.

Switch the boot mode switch to SPI-NOR boot:
   - BOOT2 to on, BOOT0, BOOT1 and BOOT3 to open

Reboot the platform.

---

Note: If the SDCard contain partitions with the same partition label or
UUID than the ones in the eMMC, the platform can fail at Linux boot stage
or boot on the wrong device.

---

Note: The default devicetree generated by CubeMX does not have SPI NOR
support enabled. Please look at commit f08d782 ("board/st/dts/mp257f-ev1-mx: Add support for missing SPI nor description")
to enable the SPI_NOR support in your devicetree.
